name: Release Triggered Deploy

on:
  pull_request:
    branches:
      - master
  release:
    types: [published]

jobs:
  pre-deployment-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Execute Pre Deployment Script
        run: echo "Executing Pre Deployment Script"

      - name: Returns Result
        run: exit 0

  deploy:
    needs: pre-deployment-check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Do Something
        run: echo "Deploying ${GITHUB_REF}"

  notify-failure:
    needs: pre-deployment-check
    if: ${{ failure()}}
    runs-on: ubuntu-latest

    steps:
      - name: Notify to Discord
        run: |
          curl -X POST -H "Content-Type: application/json" \
            -d '{"content": "Deployment failed."}' \
            ${{ secrets.DISCORD_WEBHOOK_URL }}